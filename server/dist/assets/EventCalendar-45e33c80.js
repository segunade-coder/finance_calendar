import{r as a,M as J,j as s,B as N,I as Q,A as $,a as w,L as X,f as E,b as u,C as Z,P as ee,c as G,m as P,s as H,T as le,d as Y,e as W,g as re,h as q,i as oe}from"./index-9b3e82f7.js";import{c as se,C as ie}from"./confirmdialog.esm-0e1fe004.js";import{a as ne,A as ce,b as de}from"./Dialogs-cdfc4573.js";import{R as me}from"./rating.esm-0fc3bd2e.js";import{D as K}from"./inputtextarea.esm-fe1d180e.js";import"./inputnumber.esm-a336fc43.js";import"./multiselect.esm-6a74c009.js";const ue=({people:r,setPeople:x,isLoadingPeople:c})=>{let{io:t}=a.useContext(J);const[p,i]=a.useState([]),[d,v]=a.useState(""),[m,o]=a.useState(""),[b,g]=a.useState(""),[j,h]=a.useState(!1),[f,y]=a.useState(!1),[C,M]=a.useState(""),[F,T]=a.useState(!1),[z,A]=a.useState("");a.useEffect(()=>{A(""),i(r)},[r]);const B=l=>{let e=r.find(n=>n.name.toLowerCase().trim()===l.toLowerCase().trim());M([e.name]),T(!0)},I=l=>{x(r.filter(e=>e.id!==l)),t.volatile.emit("delete-person",{id:l},e=>{e.status?u.success(e.message,{id:"delete"}):u.error(e.message,{id:"delete"})})},L=l=>{se({message:"Do you want to delete this person?",header:"Delete Confirmation",icon:"pi pi-info-circle",acceptClassName:"p-button-danger",accept:()=>I(l),reject:()=>{}})},R=()=>{d!==""&&m!==""&&b!==""&&(y(!0),u.loading("Creating User",{id:"create"}),t.volatile.emit("add-person",{name:d,role:m,email:b},l=>l.status?u.success(l.message):u.error(l.message)),y(!1),h(!1),v(""),o(""),g(""))},V=s.jsxs("div",{children:[s.jsx(N,{label:"Cancel",icon:"pi pi-times",onClick:()=>h(!1),className:"p-button-text",size:"small"}),s.jsx(N,{label:"Add",icon:"pi pi-check-circle",onClick:()=>R(),autoFocus:!0,size:"small",loading:f})]}),_=s.jsxs("div",{children:[s.jsx(N,{label:"Cancel",icon:"pi pi-times",onClick:()=>T(!1),className:"p-button-text",size:"small"}),s.jsx(N,{label:"Add",autoFocus:!0,icon:"pi pi-check-circle",size:"small",loading:f})]}),O=l=>{A(l),i(l===""||l===null?r:r.filter(({name:e})=>e.toLowerCase().match(l.toLowerCase().trim())))};return s.jsxs("div",{className:"people",children:[s.jsxs("div",{className:"people-action",children:[s.jsx(N,{label:"",icon:j?"pi pi-minus":"pi pi-plus",text:!0,className:"no-shadow p-button-rounded",size:"small",onClick:()=>h(!j),disabled:c}),s.jsx(Q,{placeholder:"Search People...",value:z,onChange:l=>O(l.target.value),type:"search",disabled:c})]}),s.jsx("div",{className:"people-card",children:c?s.jsx("div",{children:"loading.."}):p.length>0?p.map((l,e)=>s.jsxs("div",{className:"peep",children:[s.jsxs("div",{className:"content",children:[s.jsx($,{label:l.name[0].toUpperCase(),size:"large",shape:"circle",style:{backgroundColor:w(e)[0],color:w(e)[1]}}),s.jsxs("div",{className:"details ",children:[s.jsxs(X,{to:`person/${l.user_id}`,children:[l.name,s.jsx("small",{style:{display:"block",fontSize:"0.7rem",fontFamily:"Poppins-Medium"},children:l.email})]}),s.jsx("small",{className:"card-tasks",title:E(l.role),children:E(l.role)})]})]}),s.jsx("div",{className:"cf",children:s.jsx("i",{className:"pi pi-fw pi-trash",style:{color:"#EF4444"},onClick:()=>L(l.id)})}),s.jsx("div",{className:"p-footer",children:s.jsx(N,{icon:"pi pi-plus",text:!0,size:"small",className:"p-button-outlined no-shadow",severity:"help",onClick:()=>B(l.name)})})]},l.email)):s.jsx("div",{style:{color:"#7a7a7a",margin:"0.5rem auto 0"},children:"Nothing here"})}),s.jsx(ne,{showModal:j,setShowModal:h,footer:V,name:d,role:m,email:b,setName:v,setRole:o,setEmail:g}),s.jsx(ce,{showModal:F,setShowModal:T,assignTo:C,footer:_})]})};var U=Z.extend({defaultProps:{__TYPE:"AvatarGroup",style:null,className:null,children:void 0}}),ae=a.forwardRef(function(r,x){var c=a.useContext(ee),t=U.getProps(r,c),p=U.setMetaData({props:t}),i=p.ptm,d=a.useRef(null),v=G("p-avatar-group p-component",t.className);a.useImperativeHandle(x,function(){return{props:t,getElement:function(){return d.current}}});var m=P({ref:d,style:t.style,className:v},U.getOtherProps(t),i("root"));return a.createElement("div",m,t.children)});ae.displayName="AvatarGroup";var D=Z.extend({defaultProps:{__TYPE:"ProgressBar",id:null,value:null,showValue:!0,unit:"%",style:null,className:null,mode:"determinate",displayValueTemplate:null,color:null,children:void 0}}),te=a.memo(a.forwardRef(function(r,x){var c=a.useContext(ee),t=D.getProps(r,c),p=D.setMetaData({props:t}),i=p.ptm,d=a.useRef(null),v=function(){if(t.showValue&&t.value!=null){var g=t.displayValueTemplate?t.displayValueTemplate(t.value):t.value+t.unit;return g}return null},m=function(){var g=G("p-progressbar p-component p-progressbar-determinate",t.className),j=v(),h=P({id:t.id,ref:d,className:g,style:t.style,role:"progressbar","aria-valuemin":"0","aria-valuenow":t.value,"aria-valuemax":"100"},D.getOtherProps(t),i("root")),f=P({className:"p-progressbar-value p-progressbar-value-animate",style:{width:t.value+"%",display:"flex",backgroundColor:t.color}},i("value")),y=P({className:"p-progressbar-label"},i("label"));return a.createElement("div",h,a.createElement("div",f,t.value!=null&&t.value!==0&&t.showValue&&a.createElement("div",y,j)))},o=function(){var g=G("p-progressbar p-component p-progressbar-indeterminate",t.className),j=P({id:t.id,ref:d,className:g,style:t.style,role:"progressbar"},D.getOtherProps(t),i("root")),h=P({className:"p-progressbar-indeterminate-container"},i("indeterminateContainer")),f=P({className:"p-progressbar-value p-progressbar-value-animate",style:{backgroundColor:t.color}},i("value"));return a.createElement("div",j,a.createElement("div",h,a.createElement("div",f)))};if(a.useImperativeHandle(x,function(){return{props:t,getElement:function(){return d.current}}}),t.mode==="determinate")return m();if(t.mode==="indeterminate")return o();throw new Error(t.mode+" is not a valid mode for the ProgressBar. Valid values are 'determinate' and 'indeterminate'")}));te.displayName="ProgressBar";const pe=({tasksArr:r,setTasksArr:x,isLoadingTasks:c,people:t})=>{let{io:p}=a.useContext(J);const[i,d]=a.useState(""),[v,m]=a.useState(null),[o,b]=a.useState(1),[g,j]=a.useState(""),[h,f]=a.useState(!1),[y,C]=a.useState([]),[M,F]=a.useState(""),[T,z]=a.useState(""),[A,B]=a.useState("");a.useEffect(()=>{F(""),C(r)},[r]);const I=e=>{p.volatile.emit("delete-task",{id:e},n=>{n.status?(x(r.filter(S=>S.id!==e)),u.success(n.message,{id:"create"})):u.error(n.message,{id:"create"})})},L=e=>{F(e),C(e==="All"||e===null||e===void 0?r:r.filter(({status:n})=>n.match(e)))},R=e=>{se({message:"Do you want to delete this task?",header:"Delete Confirmation",icon:"pi pi-info-circle",acceptClassName:"p-button-danger",accept:()=>I(e),reject:()=>{}})},V=s.jsxs("div",{children:[s.jsx(N,{label:"Cancel",icon:"pi pi-times",onClick:()=>f(!1),className:"p-button-text",size:"small"}),s.jsx(N,{label:"Add",icon:"pi pi-check-circle",onClick:()=>_(),autoFocus:!0,size:"small"})]}),_=()=>{const e=re([{task:i},{deadline:v},{priority:o},{"Assign to":g}]);e.length===0?(u.loading("Creating task",{id:"create"}),p.volatile.emit("add-task",{task:i,deadline:v,assignTo:g,status:0,priority:o,progress:0},n=>{n.status?(u.success(n.message,{id:"create"}),f(!1),j(""),d(""),m(""),b(1)):u.error(n.message,{id:"create"})})):u.error(e[0])},O=e=>{z(e),C(e===""||e===null||e===void 0?r:r.filter(n=>n.task.toLowerCase().match(e.toLowerCase().trim())))},l=e=>{console.log(e),B(e),C(e===""||e===null||e===void 0?r:r.filter(n=>JSON.parse(n.assignTo).map(k=>k.toLowerCase().match(e.toLowerCase().trim())).some(k=>k)))};return s.jsxs("div",{className:"tasks",children:[s.jsxs("div",{className:"tasks-heading",children:[s.jsx(N,{label:"",size:"small",icon:h?"pi pi-minus":"pi pi-plus",text:!0,className:"no-shadow p-button-rounded",onClick:()=>f(!h),disabled:c}),s.jsx(K,{value:M,onChange:e=>L(e.value),options:[{label:"All",value:""},{label:"Success",value:2},{label:"Pending",value:0},{label:"Working on",value:3},{label:"Stuck",value:1}],optionLabel:"label",optionValue:"value",placeholder:"filter task",showClear:!0,disabled:c}),s.jsx(Q,{placeholder:"Search Task...",value:T,onChange:e=>O(e.target.value),type:"search",disabled:c}),s.jsx(K,{value:A,onChange:e=>l(e.value),options:t.map(e=>e.name),placeholder:"Sort by people",showClear:!0,editable:!0,disabled:c})]}),s.jsx("div",{className:"tasks-card",children:c?s.jsx("div",{children:"loading.."}):y.length>0?y.map((e,n)=>s.jsx("div",{className:"task-card",children:s.jsxs("div",{className:"tasks-body",children:[s.jsx("div",{className:"p-card-heading task-content",children:s.jsx(X,{to:`event/${e.id}`,state:{event:r.filter(S=>S.id===e.id),people:t},title:e.task.length>22?e.task:"",children:e.task})}),s.jsx("div",{className:"avatar-group",children:s.jsxs(ae,{children:[e.assignTo&&JSON.parse(e.assignTo).map((S,k)=>k<2&&s.jsx($,{shape:"circle",size:"normal",label:S[0].toUpperCase()+"  ",style:{backgroundColor:w(k===0?Math.floor(Math.random()*q.length):k,!0)[0],color:w(k===0?Math.floor(Math.random()*q.length):k,!0)[1]},title:E(e.assignTo)},S)),JSON.parse(e.assignTo).length>2&&s.jsx($,{shape:"circle",size:"normal",label:JSON.parse(e.assignTo).length-2+"+",style:{backgroundColor:w(n)[0],color:w(n)[1]},title:E(e.assignTo)})]})}),s.jsx("div",{className:"status",children:s.jsx(N,{severity:H(e.status).color,label:H(e.status).text,size:"small",className:"no-shadow"})}),s.jsxs("div",{className:"deadline",children:[s.jsx(le,{target:".custom-target-icon"}),s.jsx("i",{className:"custom-target-icon pi pi-calendar p-text-secondary p-overlay-badge","data-pr-tooltip":e.deadline!==""&&Y(e.deadline)?"expired "+W(new Date(e.deadline)):"expires "+W(new Date(e.deadline)),"data-pr-position":"right","data-pr-at":"right+5 top","data-pr-my":"left center-2",style:{cursor:"pointer",color:Y(e.deadline)?"red":"green"}})]}),s.jsx("div",{className:"rating",children:s.jsx(me,{value:e.priority,cancel:!1,readOnly:!0})}),s.jsx("div",{className:"progress",children:s.jsx(te,{value:e.progress})}),s.jsx("div",{className:"delete",children:s.jsx("i",{className:"pi pi-fw pi-trash",style:{color:"#EF4444"},onClick:()=>R(e.id)})})]})},e.id)):s.jsx("div",{style:{color:"#7a7a7a",marginTop:"0.5rem"},children:"No Tasks"})}),s.jsx(de,{showModal:h,setShowModal:f,people:t,task:i,deadline:v,assignTo:g,priority:o,footer:V,setAssignTo:j,setDeadline:m,setPriority:b,setTask:d})]})},Ne=()=>{let{io:r}=a.useContext(J);const[x,c]=a.useState([]),[t,p]=a.useState(!1),[i,d]=a.useState(!1),[v,m]=a.useState([]);return document.title="Events",a.useEffect(()=>{d(!0),p(!0),r.emit("get-people"),r.emit("get-tasks"),r.emit("get-mailStatus"),r.on("set-people",({data:o})=>{c(o),p(!1)}),r.on("set-tasks",({data:o})=>{m(o),d(!1)}),r.on("mail-response",o=>{Object.keys(o).length>0&&setTimeout(()=>{o!=null&&o.status?u.success(`${o.message}  ${E(o.to)}`):u.error("Unable to send mail")},5e3)})},[]),s.jsxs("div",{className:"__events",children:[s.jsx(ie,{}),s.jsx(ue,{people:x,setPeople:c,isLoadingPeople:t}),s.jsx(pe,{people:x,tasksArr:v,setTasksArr:m,isLoadingTasks:i}),s.jsx(oe,{})]})};export{Ne as default};
